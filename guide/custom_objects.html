<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Creating Custom Objects | TwilioQuest Extensions</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/png" sizes="32x32" href="https://www.twilio.com/quest/next/favicon.png">
    <meta name="description" content="Get started building new adventures in TwilioQuest.">
    <meta name="theme-color" content="#F22F46">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/extension-docs/assets/css/0.styles.a221b2e8.css" as="style"><link rel="preload" href="/extension-docs/assets/js/app.706a53b7.js" as="script"><link rel="preload" href="/extension-docs/assets/js/2.1f33a4c7.js" as="script"><link rel="preload" href="/extension-docs/assets/js/15.f5db6409.js" as="script"><link rel="preload" href="/extension-docs/assets/js/5.fb6a7959.js" as="script"><link rel="prefetch" href="/extension-docs/assets/js/10.de6592d1.js"><link rel="prefetch" href="/extension-docs/assets/js/11.a4780670.js"><link rel="prefetch" href="/extension-docs/assets/js/12.f6841687.js"><link rel="prefetch" href="/extension-docs/assets/js/13.0e0d07b6.js"><link rel="prefetch" href="/extension-docs/assets/js/14.b5be5725.js"><link rel="prefetch" href="/extension-docs/assets/js/16.fccbace0.js"><link rel="prefetch" href="/extension-docs/assets/js/17.dfa16fc9.js"><link rel="prefetch" href="/extension-docs/assets/js/18.e24a9f3c.js"><link rel="prefetch" href="/extension-docs/assets/js/19.83c24795.js"><link rel="prefetch" href="/extension-docs/assets/js/20.7e924d99.js"><link rel="prefetch" href="/extension-docs/assets/js/21.8d2bc7c0.js"><link rel="prefetch" href="/extension-docs/assets/js/22.35a9bd9e.js"><link rel="prefetch" href="/extension-docs/assets/js/23.e95ed63b.js"><link rel="prefetch" href="/extension-docs/assets/js/24.3f118a58.js"><link rel="prefetch" href="/extension-docs/assets/js/25.4b3f21d1.js"><link rel="prefetch" href="/extension-docs/assets/js/26.2c3cf7a9.js"><link rel="prefetch" href="/extension-docs/assets/js/27.107c331d.js"><link rel="prefetch" href="/extension-docs/assets/js/3.80e36cd3.js"><link rel="prefetch" href="/extension-docs/assets/js/4.0a0da573.js"><link rel="prefetch" href="/extension-docs/assets/js/6.29ba987c.js"><link rel="prefetch" href="/extension-docs/assets/js/7.3c2e8fd5.js"><link rel="prefetch" href="/extension-docs/assets/js/8.3e2d7572.js"><link rel="prefetch" href="/extension-docs/assets/js/9.aa62bb3a.js">
    <link rel="stylesheet" href="/extension-docs/assets/css/0.styles.a221b2e8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/extension-docs/" class="home-link router-link-active"><!----> <span class="site-name">TwilioQuest Extensions</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/extension-docs/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/extension-docs/api/" class="nav-link">
  API Reference
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/extension-docs/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/extension-docs/api/" class="nav-link">
  API Reference
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/extension-docs/guide/" aria-current="page" class="sidebar-link">Getting Started</a></li><li><a href="/extension-docs/guide/architecture.html" class="sidebar-link">Architecture Overview</a></li><li><a href="/extension-docs/guide/levels.html" class="sidebar-link">Creating New Levels</a></li><li><a href="/extension-docs/guide/maps.html" class="sidebar-link">Editing Maps</a></li><li><a href="/extension-docs/guide/objectives.html" class="sidebar-link">Creating Objectives</a></li><li><a href="/extension-docs/guide/npcs.html" class="sidebar-link">Non Player Characters</a></li><li><a href="/extension-docs/guide/events.html" class="sidebar-link">Event Scripting</a></li><li><a href="/extension-docs/guide/custom_objects.html" aria-current="page" class="active sidebar-link">Creating Custom Objects</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/extension-docs/guide/custom_objects.html#what-is-an-object" class="sidebar-link">What is an Object?</a></li><li class="sidebar-sub-header"><a href="/extension-docs/guide/custom_objects.html#built-in-objects" class="sidebar-link">Built-in Objects</a></li><li class="sidebar-sub-header"><a href="/extension-docs/guide/custom_objects.html#making-a-custom-object-in-twilioquest" class="sidebar-link">Making a custom object in TwilioQuest</a></li><li class="sidebar-sub-header"><a href="/extension-docs/guide/custom_objects.html#placing-an-object-in-the-world" class="sidebar-link">Placing an object in the world</a></li><li class="sidebar-sub-header"><a href="/extension-docs/guide/custom_objects.html#animating-an-object" class="sidebar-link">Animating an object</a></li><li class="sidebar-sub-header"><a href="/extension-docs/guide/custom_objects.html#changing-an-object-s-animation-in-response-to-events" class="sidebar-link">Changing an object's animation in response to events</a></li><li class="sidebar-sub-header"><a href="/extension-docs/guide/custom_objects.html#persisting-object-state-across-sessions" class="sidebar-link">Persisting object state across sessions</a></li><li class="sidebar-sub-header"><a href="/extension-docs/guide/custom_objects.html#pull-object-properties-from-tiled" class="sidebar-link">Pull object properties from Tiled</a></li></ul></li><li><a href="/extension-docs/guide/distribution.html" class="sidebar-link">Distributing Your Extension</a></li></ul></section></li></ul> </aside> <main sidebar-items="[object Object]" class="page"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css"> <a target="_blank" href="http://github.com/TwilioQuest/extension-docs" data-ribbon="Contribute on GitHub" title="Contribute on GitHub" class="github-fork-ribbon left-bottom fixed">
    Contribute on GitHub
  </a> <div class="theme-default-content content__default"><h1 id="creating-custom-objects"><a href="#creating-custom-objects" class="header-anchor">#</a> Creating Custom Objects</h1> <p>Sometimes you want to do more than just paint a scene with tiles. You want to open a chest or talk to an NPC. Objects are how you create dynamism in the TwilioQuest world.</p> <div class="custom-block warning"><p class="custom-block-title">WIP ⚠️</p> <p>This guide is still a work in progress!</p></div> <h2 id="what-is-an-object"><a href="#what-is-an-object" class="header-anchor">#</a> What is an Object?</h2> <p>Objects in TwilioQuest are <em>things</em> that create dyanmic behavior. This could be something like an NPC or a door that opens when you approach it.</p> <p>An object is composed of a few different configuration files.</p> <ul><li>A configuration file called <code>config.js</code></li> <li>Any image files needed to render the object</li> <li>An icon image for use in Tiled tilesets</li></ul> <h2 id="built-in-objects"><a href="#built-in-objects" class="header-anchor">#</a> Built-in Objects</h2> <p>TwilioQuest comes with built in objects that handle some of the common use cases you might have for dynamic objects. Check out the <a href="/extension-docs/api/objects.html">built in objects API page</a> for a list of these before re-building something that already exists!</p> <h2 id="making-a-custom-object-in-twilioquest"><a href="#making-a-custom-object-in-twilioquest" class="header-anchor">#</a> Making a custom object in TwilioQuest</h2> <p>Objects in TwilioQuest have a core <code>config.js</code> files that exports a module with information TwilioQuest uses to create the object in game. That basic structure with an empty config looks like this:</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  spriteSheets<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  animations<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  properties<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>We're going to go through and add various pieces of configuration to this export to create a laser barrier.</p> <h3 id="start-with-the-visual"><a href="#start-with-the-visual" class="header-anchor">#</a> Start with the visual</h3> <p>The first thing to consider about a new object is how it appears. What does it look like rendered in the game? Our laser barrier will look like this:</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAAAwCAYAAACynDzrAAAAyUlEQVR42u3WIQoCQRSA4ameYbt2T6AIJoMXEMQ7aPEC3sBsNpgNHkCD59m28hZWJxhE0DLfDw+mvh9m5k8JAAAAAPB3ZsN5s15tnlO6j9xFuEn327XJKVlS7J4Tbt4Kugx6TT2qiprY+WNB9bZqSiN2JugbQcfTuT10s5gui71isXvuItykw27fHrppX+6Cf/TcRbhJk/64ldKN7Hm5CDdCUCgKRaEoFIWiUBSKQlEoCkWhKBSFolAUikJRKApFoSgUAQAAgN/yAFpNx0ws7QWKAAAAAElFTkSuQmCC" alt="image of laser barrier"></p> <p>We'd also like our object to be animated in a few ways, so we won't be able to <em>just</em> use that image though. In order to describe these animations we'll want to use something a bit more powerful than a single image called a &quot;spritesheet&quot;.</p> <h3 id="what-is-a-spritesheet"><a href="#what-is-a-spritesheet" class="header-anchor">#</a> What is a spritesheet?</h3> <p>A spritesheet is a series of frames with an image on them. Usually, this series depicts one of more animations that it's subject is performing. Our laser barrier will have three animations: <code>close</code>, <code>idle</code>, and <code>open</code>.</p> <p>Here's the spritesheet we're going to use. Each animation is labeled and on a different row and each frame is numbered.</p> <p><img src="/extension-docs/assets/img/custom_object_spritesheet_animations.01fbe2b7.png" alt="labeled diagram of laser spritesheet"></p> <h3 id="importing-a-spritesheet"><a href="#importing-a-spritesheet" class="header-anchor">#</a> Importing a spritesheet</h3> <p>We need to add a little bit of information to our <code>config.js</code> export to get this spritsheet loaded into TwilioQuest.</p> <p>First, we'll need to add a new unique key to the <code>spritesheets</code> property of our root object. This key needs to be unique across all imported spritesheets in all extensions, so it's a good idea to use a verbose name here (it still needs to be a valid JavaScript key!). We'll use this key: <code>twilioquest_laserBarrierHorizontal</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  spriteSheets<span class="token operator">:</span> <span class="token punctuation">{</span>
    twilioquest_base_laserBarrierHorizontal<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Next, we need to add the name of our spritesheet file. Ours is called <code>twilioquest_laser_horizontal.png</code>. This file should be stored right next to our <code>config.js</code> file.</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  spriteSheets<span class="token operator">:</span> <span class="token punctuation">{</span>
    twilioquest_base_laserBarrierHorizontal<span class="token operator">:</span> <span class="token punctuation">{</span>
      fileName<span class="token operator">:</span> <span class="token string">&quot;twilioquest_laser_horizontal.png&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Finally, we need to calculate the frame dimensions for our spritesheet. We're looking for a &quot;frame height&quot; and &quot;frame width&quot; in particular.</p> <p><img src="/extension-docs/assets/img/custom_object_spritesheet_labeled.ed80182a.png" alt="image of a spritesheet's components labeled"></p> <p>For our spritesheet, the frame's width is 72 pixels and the height is 48 pixels. Since the base tile size in TwilioQuest is 24x24 pixels, this means our laser barrier object will take up a 3x2 tile space on the map.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Be sure to count the whitespace surrounding each of the frames! It can be hard to calculate this by eyeballing from a single frame. A useful trick is to take the width or height of the spritesheet image and divide it by the number of rows or columns in the sheet.</p></div> <p>Here is our final set of modifications to <code>config.js</code> to import the laser barrier spritesheet.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  spriteSheets<span class="token operator">:</span> <span class="token punctuation">{</span>
    laserSpriteSheet<span class="token operator">:</span> <span class="token punctuation">{</span>
      fileName<span class="token operator">:</span> <span class="token string">'twilioquest_laser_horizontal.png'</span><span class="token punctuation">,</span>
      frameDimensions<span class="token operator">:</span> <span class="token punctuation">{</span>
        width<span class="token operator">:</span> <span class="token number">72</span><span class="token punctuation">,</span>
        height<span class="token operator">:</span> <span class="token number">48</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="placing-an-object-in-the-world"><a href="#placing-an-object-in-the-world" class="header-anchor">#</a> Placing an object in the world</h2> <p>We have the minimal set of information needed to render a custom object in TwilioQuest. It doesn't do anything fancy yet, but let's get it showing up!</p> <h3 id="icon-for-tiled"><a href="#icon-for-tiled" class="header-anchor">#</a> Icon for Tiled</h3> <p>Tiled does not understand how to use spritesheets for its icons. Instead, you'll want to take a single frame of your sheet and make it its own file called <code>icon.png</code>.</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAAAwCAYAAACynDzrAAAAyUlEQVR42u3WIQoCQRSA4ameYbt2T6AIJoMXEMQ7aPEC3sBsNpgNHkCD59m28hZWJxhE0DLfDw+mvh9m5k8JAAAAAPB3ZsN5s15tnlO6j9xFuEn327XJKVlS7J4Tbt4Kugx6TT2qiprY+WNB9bZqSiN2JugbQcfTuT10s5gui71isXvuItykw27fHrppX+6Cf/TcRbhJk/64ldKN7Hm5CDdCUCgKRaEoFIWiUBSKQlEoCkWhKBSFolAUikJRKApFoSgUAQAAgN/yAFpNx0ws7QWKAAAAAElFTkSuQmCC" alt="icon image for Tiled"></p> <div class="custom-block warning"><p class="custom-block-title">WIP: Instructions for creating a Tiled Object Sheet</p> <p>Tiled allows you to create and modify your own tilesets. We use a &quot;collection of images&quot; tileset to manage objects in TwilioQuest. These are <a href="https://doc.mapeditor.org/en/stable/manual/editing-tilesets/" target="_blank" rel="noopener noreferrer">the official Tiled docs on editing Tilesets<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <h3 id="placing-our-laser-barrier-in-tiled"><a href="#placing-our-laser-barrier-in-tiled" class="header-anchor">#</a> Placing our laser barrier in Tiled</h3> <p>Check out the <a href="/extension-docs/guide/maps.html">map editing guide</a> for more information about how to place objects in Tiled.</p> <h2 id="animating-an-object"><a href="#animating-an-object" class="header-anchor">#</a> Animating an object</h2> <p>Now that we have an object in TwilioQuest, let's animate it!</p> <h3 id="loading-animations"><a href="#loading-animations" class="header-anchor">#</a> Loading animations</h3> <p>First, we'll need to add some new information to the <code>animations</code> key of our exported <code>config.js</code> object. Each key of this animation object corresponds to an animation this object can use. These keys only need to be unique in the context of this object. No need for global identifiers!</p> <p>We have three animations we want to create for our laser barrier: <code>close</code>, <code>idle</code>, and <code>open</code>.</p> <p><img src="/extension-docs/assets/img/custom_object_spritesheet_animations.01fbe2b7.png" alt="example of a spritesheet"></p> <p>Let's create an empty key for each of these animations.</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  animations<span class="token operator">:</span> <span class="token punctuation">{</span>
    close<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    idle<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    open<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>An animation requires two pieces of information to describe it. We need an array listing all the frames in order that this animation will play called <code>frames</code>. We also need a <code>frameRate</code> variable to control how many frames per second TwilioQuest will play this animation with. Usually, the frameRate should be equal to the length of the frames array.</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  animations<span class="token operator">:</span> <span class="token punctuation">{</span>
    close<span class="token operator">:</span> <span class="token punctuation">{</span>
      frames<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      frameRate<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    idle<span class="token operator">:</span> <span class="token punctuation">{</span>
      frames<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      frameRate<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    open<span class="token operator">:</span> <span class="token punctuation">{</span>
      frames<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      frameRate<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="playing-an-animation"><a href="#playing-an-animation" class="header-anchor">#</a> Playing an animation</h3> <p>This will be our first implementation of custom scripted behavior! Objects have no animation by default, so we're going to start playing an animation when the map it's in gets loaded.</p> <p>TwilioQuest objects can have an <code>events</code> property at the root of their exported <code>config.js</code> object. This property contains an object that can have many different event listeners. Read more about the <a href="/extension-docs/api/custom_objects.html#object-configuration-file">events property</a> API.</p> <p>We're going to use the <code>onMapDidLoad</code> property for our use case.</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  events<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">onMapDidLoad</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">self</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;I'm in a map that loaded!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>In the above code sample, we're only logging a statement to the console. But, we're also given access to an instance of our game object called <code>self</code>. The <a href="/extension-docs/api/custom_objects.html#object-configuration-file">self object</a> has many documented APIs. We're interested in the <code>playAnimation</code> function in particular.</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  events<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">onMapDidLoad</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">self</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      self<span class="token punctuation">.</span><span class="token function">playAnimation</span><span class="token punctuation">(</span><span class="token string">&quot;idle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Once we add this event handler in, we should see our laser barrier playing its idling animation inside of TwilioQuest.</p> <h2 id="changing-an-object-s-animation-in-response-to-events"><a href="#changing-an-object-s-animation-in-response-to-events" class="header-anchor">#</a> Changing an object's animation in response to events</h2> <p>Playing our laser barrier animation is a great start, but we also want our barrier to open up after its objective is completed! We're going to listen to a new event called <code>objectiveCompleted</code> to accomplish this.</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  events<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">onObjectiveCompleted</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">self<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>This will be the first event we use where we actually want to inspect the event payload. The <a href="/extension-docs/api/events.html#objectivecompleted">objectiveCompleted</a> event has an <code>objective</code> property we can check to see if the appropriate objective was passed.</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  events<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">onObjectiveCompleted</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">self<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>objective <span class="token operator">===</span> <span class="token string">&quot;our_custom_objective&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        self<span class="token punctuation">.</span><span class="token function">playAnimation</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Now, when we load into TwilioQuest and hack an objective we should see it slide open! We still cannot pass through this opened barrier though, we need to do one more thing to make that work.</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  events<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">onObjectiveCompleted</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">self<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>objective <span class="token operator">===</span> <span class="token string">&quot;our_custom_objective&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        self<span class="token punctuation">.</span><span class="token function">playAnimation</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        self<span class="token punctuation">.</span>sprite<span class="token punctuation">.</span>body<span class="token punctuation">.</span>enable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>This is a little bit of a hack, as there is no official API function for what we need yet. But here we reference the internal Phaser sprite representing our object and set its physics body to be disabled. This means our player can no longer collide with it and may pass right through.</p> <p>We have a problem now though, when you close and re-open TwilioQuest the barrier is back in its idle locked animation!</p> <h2 id="persisting-object-state-across-sessions"><a href="#persisting-object-state-across-sessions" class="header-anchor">#</a> Persisting object state across sessions</h2> <p>We're going to take advantage of objects' <code>state</code> and <code>render</code> properties to reference persisted data across loads.</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// closed, opening, open</span>
    animation<span class="token operator">:</span> <span class="token string">&quot;closed&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  events<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">onMapDidLoad</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">self<span class="token punctuation">,</span> event<span class="token punctuation">,</span> world</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>world<span class="token punctuation">.</span><span class="token function">isObjectiveCompleted</span><span class="token punctuation">(</span><span class="token string">&quot;our_custom_objecitve&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        self<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          animation<span class="token operator">:</span> <span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">onObjectiveCompleted</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">self<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>objective <span class="token operator">===</span> <span class="token string">&quot;our_custom_objective&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        self<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          animation<span class="token operator">:</span> <span class="token string">&quot;opening&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">self<span class="token punctuation">,</span> world</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>animation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&quot;closed&quot;</span><span class="token operator">:</span>
        self<span class="token punctuation">.</span><span class="token function">playAnimation</span><span class="token punctuation">(</span><span class="token string">&quot;idle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">&quot;opening&quot;</span><span class="token operator">:</span>
        self<span class="token punctuation">.</span><span class="token function">playAnimation</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          self<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            animation<span class="token operator">:</span> <span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">&quot;open&quot;</span><span class="token operator">:</span>
        self<span class="token punctuation">.</span>sprite<span class="token punctuation">.</span>frame <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="pull-object-properties-from-tiled"><a href="#pull-object-properties-from-tiled" class="header-anchor">#</a> Pull object properties from Tiled</h2> <p>We have hardcoded our objective name as <code>&quot;our_custom_objective&quot;</code>. Let's make one last change to our custom laser barrier object so that it can pull the <code>objectiveName</code> property in from Tiled.</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// closed, opening, open</span>
    animation<span class="token operator">:</span> <span class="token string">&quot;closed&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  events<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">onMapDidLoad</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">self<span class="token punctuation">,</span> event<span class="token punctuation">,</span> world</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>world<span class="token punctuation">.</span><span class="token function">isObjectiveCompleted</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>objectiveName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        self<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          animation<span class="token operator">:</span> <span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">onObjectiveCompleted</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">self<span class="token punctuation">,</span> event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>objective <span class="token operator">===</span> self<span class="token punctuation">.</span>objectiveName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        self<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          animation<span class="token operator">:</span> <span class="token string">&quot;opening&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">self<span class="token punctuation">,</span> world</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>animation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&quot;closed&quot;</span><span class="token operator">:</span>
        self<span class="token punctuation">.</span><span class="token function">playAnimation</span><span class="token punctuation">(</span><span class="token string">&quot;idle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">&quot;opening&quot;</span><span class="token operator">:</span>
        self<span class="token punctuation">.</span><span class="token function">playAnimation</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          self<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            animation<span class="token operator">:</span> <span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">&quot;open&quot;</span><span class="token operator">:</span>
        self<span class="token punctuation">.</span>sprite<span class="token punctuation">.</span>frame <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Now we can set the property <code>objectiveName</code> on any of our laser barriers to change which objective it will open for.</p></div></main></div><div class="global-ui"></div></div>
    <script src="/extension-docs/assets/js/app.706a53b7.js" defer></script><script src="/extension-docs/assets/js/2.1f33a4c7.js" defer></script><script src="/extension-docs/assets/js/15.f5db6409.js" defer></script><script src="/extension-docs/assets/js/5.fb6a7959.js" defer></script>
  </body>
</html>
